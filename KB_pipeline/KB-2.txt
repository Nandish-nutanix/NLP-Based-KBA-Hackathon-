25/01/25, 9:39 AM
Page 1 of 5about:srcdocLCM Pre-check:test_hosts_in_maintenance_modeArticle #KB-9046Last modiﬁed onNov 22nd 2023Summary:LCM pre-check test_hosts_in_maintenance_mode checks if any host is inMaintenance mode.Versions affected:LCM 2.x
LCMDescription:LCM pre-check test_hosts_in_maintenance_mode checks if any host is in Maintenancemode.A host could be left in maintenance due to previous upgrade failure, maintenanceactivity etc.LCM update operation fails with the following error when it detects 1 or more host(s) inMaintenance mode.25/01/25, 9:39 AM
Page 2 of 5about:srcdoc
 
Solution:For AHV1. Identify the host that is not Schedulable.Operation failed. Reason: Lcm prechecks detected 1 issue that would cause upgrade failures. Check 'test_hosts_in_maintenance_mode' failed: Hosts xx.x.xx.10 xx.x.xx.11 are in maintenance mode. Please refer to KB 904625/01/25, 9:39 AM
Page 3 of 5about:srcdoc2. Check the status of the host:3. Check for Node_state --> "kEnteredMaintenanceMode"4. Check for "Schedulable" value --> FalseIf 1 and 2 are True, proceed to the next step. Otherwise, contact Nutanix Support.Example output:nutanix@CVM~$ acli host.listHypervisor IP  Hypervisor DNS Name  Host UUID                             Compute Only  Schedulable  Hypervisor Type  Hypervisor Namexx.xx.xx.11     xx.xx.xx.xx          58dffc17-896e-48ff-87a6-e90b23b20471  False         False        kKvm             AHVxx.xx.xx.xx     xx.xx.xx.xx          65fa3fb3-56f1-444d-872d-d144a0c54c8e  False         True         kKvm             AHVxx.xx.xx.xx     xx.xx.xx.xx          70167025-1b2c-4c79-ac04-85dc547ea9e4  False         True         kKvm             AHVxx.xx.xx.xx     xx.xx.xx.xx          67320f01-d4a8-4363-9cc4-1e676a61cc54  False         True         kKvm             AHVnutanix@CVM~$ acli host.get <Hypervisor IP or Hypervisor DNS Name or Host UUID>25/01/25, 9:39 AM
Page 4 of 5about:srcdoc5. If the host is in Maintenance Mode, exit maintenance mode for that host.6. Re-run LCM update operation.For ESXi1. Login to vCenter and check if any ESXi host is in Maintenance mode.2. Exit Maintenance mode. Wait for few mins until CVM is online and services are up.3. Re-run LCM update operationFor Hyper-V1. Check the status of cluster nodes:nutanix@CVM~$ acli host.get xx.xx.xx.11xx.xx.xx.xx {  cpu_usage_ppm: 35708  cvm_memory_size_bytes: 34359738368  cvm_num_vcpus: 12  cvm_uuid: "d39c8813-9029-4228-ad5e-d1e82fc82e0f"  logical_timestamp: 201  max_mem_ha_reserved_bytes: 0  mem_assigned_bytes: 0  mem_usage_bytes: 38467761771  memory_size_bytes: 269889830912  node_state: "kEnteredMaintenanceMode"  num_cpus: 80  schedulable: False  uuid: "58dffc17-896e-48ff-87a6-e90b23b20471"}nutanix@CVM~$ acli host.exit_maintenance_mode <Hypervisor IP or Hypervisor DNS Name or Host UUID>25/01/25, 9:39 AM
Page 5 of 5about:srcdoc2. In this example, the node HPVHST12 is in a Paused state. Bring it back online:3. Re-run LCM update operation.nutanix@NTNX-XXX-B-CVM:10.xx.xx.xx:~$ winsh192.168.5.1> Get-ClusternodeName                 ID    State                                                                                                                                        ----                 --    -----                                                                                                                                        HPVHST12          1     Paused                                                                                                                                       HPVHST13          7     Up                                                                                                                                           HPVHST14          6     Up                                                                                                                                           HPVHST15          8     Up                                                                                                                                           HPVHST16          11    Up                                                                                                                                           HPVHST17          4     Up                                                                                                                                           HPVHST18          9     Up                                                                                                                                           HPVHST19          3     Up                                                                                                                                           HPVHST20          2     Up                                                                                                                                           HPVHST21          10    Up                                                                                                                                           HPVHST22          5     Upnutanix@NTNX-XXX-B-CVM:10.xx.xx.xx:~$ winsh Resume-Clusternode HPVHST12