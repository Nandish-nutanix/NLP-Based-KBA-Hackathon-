27/01/25, 6:36 PM
Page 1 of 5about:srcdocNCC Health Check:cluster_services_down_checkArticle #KB-1518Last modiﬁed onApr 30th 2024Summary:The NCC health check cluster_services_down_check veriﬁes if the clusterservices are running on all Controller VMs in the cluster. If any clusterservice is not running on any of the Controller VMs in the cluster, thischeck fails.
Troubleshooting
NCCDescription:The NCC health check cluster_services_down_check verifies if the clusterservices are running on all Controller VMs in the cluster. If any cluster service is notrunning on any of the Controller VMs in the cluster, this check fails.Running the NCC CheckYou can run this check as part of the complete NCC Health Checks:Or you can run this check separately:You can also run the checks from the Prism web console Health page: select Actionsnutanix@cvm$ ncc health_checks run_allnutanix@cvm$ ncc health_checks system_checks cluster_services_down_check27/01/25, 6:36 PM
Page 2 of 5about:srcdoc> Run Checks. Select All checks and click Run.This check is scheduled to run every minute, by default.Sample outputFor status: PASS
For status: FAILRunning : health_checks system_checks cluster_services_down_check[=====================================] 100%/health_checks/system_checks/cluster_services_down_check         [ PASS ]+---------------+| State | Count |+---------------+| Pass  | 1     || Total | 1     |+---------------+Plugin output written to /home/nutanix/data/logs/ncc-output-latest.logDetailed information for cluster_services_down_check:Node x.x.x.x:FAIL: Services are down:curatorscavengerNode x.x.x.x:FAIL: Services are down:cassandrascavenger27/01/25, 6:36 PM
Page 3 of 5about:srcdocFor PC (Prism Central) ClusterThis check verifies whether all services are running on PC VM.Note: If the Cluster Health service status is DOWN for more than 15 minutes, an alertemail is sent by the AOS cluster to configured addresses and Nutanix Support (ifselected). In this case, no alert is generated in the Prism web console. The email issent once per 24 hours. You can run the NCC checkcluster_services_down_check to see the service status.Output messagingCheck ID3032DescriptionCheck that no services are down in the cluster.Causes of failureOne or more services in the cluster are down.ResolutionsIf this check occurs once or infrequently, no action is necessary.ImpactCluster performance may be significantly degraded. In the case ofmultiple services with the same condition, the cluster may becomeunable to serve I/O requests.Alert IDA3032Alert TitleCluster services are downAlert Smart TitleCluster services down on Controller VM ip_addressAlert MessageCluster Service: service_name is down on the Controller VM ip_address.Solution:Run the following command to conﬁrm if any service is currently down:27/01/25, 6:36 PM
Page 4 of 5about:srcdocIf any services are listed as DOWN, start those services by using the followingcommand:If there are issues starting some services, check the following:1. Check if the node is in maintenance mode by running the ncli host ls command onthe CVM. Verify if the parameter Under Maintenance Mode is set to False for thenode where the services are down. If the parameter Under Maintenance Mode isset to True, remove the node from maintenance mode by running the followingcommand:You can determine the host ID by using ncli host ls.2. See the troubleshooting topics related to failed cluster services in the AdvancedAdministration Guide available from the Nutanix Portal's Software Documentationpage. (Use the filters to search for the guide for your AOS version). These topicshave information about common and AOS-specific logs, such as Stargate,Cassandra, and other modules.3. Check for any latest FATALs for the service that is down. The following commandprints all the FATALs for a CVM. Run this command on all CVMs.If a service does not start, or if you see FATAL logs for the service that is down, collectthe logs and contact Nutanix Support for assistance.Collect logbay bundle for the timestamp when the alert was noticed. For morenutanix@cvm$ cluster status | grep -v UPnutanix@cvm$ cluster start
nutanix@cvm$ ncli host edit id=<host id> enable-maintenance-mode=false
nutanix@cvm$ for i in `svmips`; do echo "CVM: $i"; ssh $i "ls -ltr /home/nutanix/data/logs/*.FATAL"; done27/01/25, 6:36 PM
Page 5 of 5about:srcdocinformation on logbay, see KB 6691.For PC VM1. Check if any services are down using the below command:2. If any service is listed as DOWN, start that service using the below command:3. Verify if all services are running using the command provided in step 1.If the above commands do not help and you still see a service reported as DOWN,open a case to engage Nutanix Support at https://portal.nutanix.com/.Collect logbay bundle for the timestamp when the alert was noticed. For moreinformation on logbay, see KB 6691.nutanix@pcvm$ cluster status | grep -v UPnutanix@pcvm$ cluster start